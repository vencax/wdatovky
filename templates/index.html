
<!DOCTYPE html>
<html lang="cz">
<head>
  <meta charset='UTF-8'/>
  <title>Posilac datovych zprav</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.1.4/zepto.min.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.1/css/foundation.min.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
</head>
<body>

  <div class="row">
    <section role="main">
      <div class="small-12 columns ">

		<h1>Posilac datovych zprav</h1>

		<div id="frm">

	      <label>Adresat
	        <input id="lr" name="recpt" type="text" placeholder="datova schranka prijemce" />
	      </label>

	      <label>Predmet
	        <input id="ls" name="subj" type="text" placeholder="predmet" />
	      </label>

	      <label>Zprava
	        <textarea id="mess" name="content" placeholder="text zpravy" style="height: 8em;"></textarea>
	      </label>

        <div class="row">
          <div class="small-6 columns">

            <label>Priloha (nepovinne)
              <input type="file" id="attach" multiple>
            </label>

            <hr/>

            <label>Username
    	        <input id="un" name="uname" type="text" placeholder="Tvoje prihlasovaci jmeno do DS" />
    	      </label>

    	      <label>Heslo
    	        <input id="pw" name="pwd" type="text" placeholder="Tvoje heslo do DS" />
    	      </label>

    	      <hr/>

            <div id="messageDiv" data-alert class="alert-box round" style="visibility: hidden;">
        		  <div id="messageContent"></div>
        		  <a href="#" class="close">&times;</a>
        		</div>
    	      <input type="submit" class="button" onClick="onFormSubmit();" value="Posli">
          </div>

          <div>
            <img src="http://factspy.net/wp-content/uploads/2011/11/IE-trollface.png" alt="troll" />
          </div>
        </div>

		</div>

		<footer>
		  	Made with hate to cz government by <a href="http://www.vxk.cz">vencax</a>.
		  	Vsechna prava vyhlazena.
		  	Fork and improve on <a href="https://github.com/vencax/wdatovky">Github</a>.
		</footer>

      </div>
    </section>
  </div>

  <script>
    // $(document).foundation();
    if (Modernizr.localstorage) {
      if("posilacDatZpravU" in localStorage) {
  	  	$("#un")[0].value = localStorage.getItem("posilacDatZpravU");
  	  }
  	  if("posilacDatZpravP" in localStorage) {
  	    $("#pw")[0].value = localStorage.getItem("posilacDatZpravP");
  	  }
  	  if("posilacDatZpravLS" in localStorage) {
  	    $("#ls")[0].value = localStorage.getItem("posilacDatZpravLS");
  	  }
  	  if("posilacDatZpravLR" in localStorage) {
  	    $("#lr")[0].value = localStorage.getItem("posilacDatZpravLR");
  	  }
      if("posilacDatZpravMESS" in localStorage) {
        $("#mess")[0].value = localStorage.getItem("posilacDatZpravMESS");
      }
  	} else {
  	  // no native support for HTML5 storage :(
  	  // maybe try dojox.storage or a third-party solution
  	}
  	function onFormSubmit() {
      var usename = $("#un")[0].value
      var passwd = $("#pw")[0].value
      var subject = $("#ls")[0].value
      var recipient = $("#lr")[0].value
      var message = $("#mess")[0].value
      var m = {
        uname: usename,
        pwd: passwd,
        subj: subject,
        recpt: recipient
      }
      if (message.length > 0) {
        m.text = message
      }
      var f1 = $("#attach")[0].files
      if (f1.length > 0) {
        var rv = []
        for(var i=0; i<f1.length; i++) {
          rv.push({
            'filename': f1[i].name,
            'content': new FileReaderSync().readAsText(f1[i])
          })
        }
        m.attach = f1.map(fun)
      }
      $('#messageDiv').hide()
      $.ajax({
        type: 'POST',
        url: '/api',
        data: JSON.stringify(m),
        contentType: 'application/json',
        success: function(data) {
          $('#messageContent').innerHTML = data
          $('#messageDiv').show()
        },
        error: function(xhr, type) {
          $('#messageDiv').innerHTML = type
        }
      })

  		localStorage.setItem("posilacDatZpravU", usename);
  		localStorage.setItem("posilacDatZpravP", passwd);
  		localStorage.setItem("posilacDatZpravLS", subject);
  		localStorage.setItem("posilacDatZpravLR", recipient);
      localStorage.setItem("posilacDatZpravMESS", message);
  	}
  </script>

</body>
